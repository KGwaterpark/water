<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.water.park.service.dao.MemberDAO">

	<insert id="insertMember">
		INSERT INTO
		member(m_id,m_pw,m_tel,m_name,m_email,m_birth,m_gender)
		VALUES
		(#{m_id},#{m_pw},#{m_tel},#{m_name},#{m_email},#{m_birth},#{m_gender})
	</insert>

	<select id="idCheck" resultType="int">
		SELECT COUNT(*)
		FROM member where
		m_id = #{m_id}
	</select>
	
	<select id="telCheck" resultType="int">
		SELECT COUNT(*)
		FROM member
		where m_tel = #{m_tel}
	</select>
	
	<!-- 로그인 -->
	<select id="memberLogin" resultType="MemberVO">
		SELECT *
		FROM member
		WHERE
		m_id = #{m_id}
	</select>
	
	<select id="getMId" resultType="String">
		SELECT m_id
		FROM member
		WHERE
		m_name = #{name}
		AND m_tel = #{tel}
	</select>

	<!-- 마이페이지 -->

	<select id="getmyinfo" resultType="MemberVO">
		SELECT
		m_id,m_pw,m_tel,m_name,m_email
		FROM member
	</select>

	<delete id="deleteMember">
		DELETE FROM member WHERE m_id=#{m_id}
	</delete>

	<select id="getAllMember" resultType="MemberVO">
    SELECT
    m_id, m_name, m_tel,
    m_email, m_birth, m_gender,
    FLOOR(MONTHS_BETWEEN(SYSDATE, m_birth) / 12) AS m_age,
    (SELECT COUNT(*) FROM MEMBER) AS total_count
    FROM MEMBER
</select>



	<!-- 회원 업데이트 -->
	<update id="updateMember">
		UPDATE member SET m_name = #{m_name}, m_tel =
		#{m_tel} WHERE m_id = #{m_id}
	</update>


	<!-- 회원 한명 불러오기 -->
	<select id="memberGet" resultType="MemberVO">
		SELECT
		m_id,m_name,m_tel,m_email,m_birth,m_gender
		FROM member where m_id =
		#{m_id}
	</select>


	<!-- 멤버 총 몇명인지 (페이징) -->
	<select id="getTotalCount2" resultType="int">
		SELECT COUNT(*)
		FROM member
	</select>
	
	<!-- 멤버 리스트 (페이징) -->
	<select id="getList2" resultType="MemberVO">
		SELECT *
		FROM (SELECT t.*,ROWNUM AS rnum
		FROM (SELECT M_id,M_pw,M_tel,M_name,M_email,M_birth,M_gender,
		FLOOR(MONTHS_BETWEEN(SYSDATE, m_birth) / 12) AS m_age
		FROM member
		ORDER BY m_id DESC)t
		WHERE <![CDATA[ROWNUM <= #{page4}]]>)
		WHERE <![CDATA[rnum >= #{page3}]]>
	</select>
	
		<!-- 멤버 검색 총 갯수 -->
	<select id="getFilterTotal" resultType="int">
		SELECT COUNT(*)
		FROM member
		<where>
			<if test="memberFilter == 'm_id'">
				AND UPPER(m_id) like #{memberSearch}
			</if>
			<if test="memberFilter == 'm_name'">
				AND UPPER(m_name) like #{memberSearch}
			</if>
		</where>
	</select>

	<!-- 멤버 검색한내용 -->
	<select id="getFilterList" resultType="MemberVO">
		SELECT *
		FROM (SELECT t.*, ROWNUM AS rnum FROM ( SELECT
		M_id,M_pw,M_tel,M_name,M_email,M_birth,M_gender,
		FLOOR(MONTHS_BETWEEN(SYSDATE, m_birth) / 12) AS m_age
		FROM member
		<where>
			<if test="memberFilter == 'm_id'">
				AND UPPER(m_id) LIKE #{memberSearch2}
			</if>
			<if test="memberFilter == 'm_name'">
				AND UPPER(m_name) LIKE #{memberSearch2}
			</if>
		</where>
		ORDER BY m_id ASC)t WHERE <![CDATA[ROWNUM <= #{page4}]]>)
		WHERE <![CDATA[rnum >= #{page3}]]>
	</select>

</mapper>